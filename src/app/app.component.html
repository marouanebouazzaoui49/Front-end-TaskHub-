<ng-container *ngIf="!isAuthPage(); else authOnly">
  <div class="d-flex vh-100">

    <!-- Sidebar -->
    <nav class="sidebar" [class.collapsed]="isSidebarCollapsed" [class.show]="isMobileSidebarOpen">
      <div class="text-center py-4">
        <img src="assets/img/TaskHub.png" alt="TaskHub Logo" class="logo" style="filter: brightness(0) invert(1); max-width:130px; margin:0 auto; transition: transform 0.6s ease;">
      </div>

      <!-- Profil complet Manager -->
      <div class="user-profile text-center mb-4 px-3">
        <div class="profile-circle mx-auto mb-2">
          <span>{{ currentUser?.fullName?.charAt(0) || 'M' }}</span>
        </div>
        <small style="color: aliceblue;" class="fw-semibold">{{ currentUser?.fullName || 'Manager' }}</small>
        <br>
        <div class="badge badge-manager mt-1" *ngIf="currentUser?.role === 'ROLE_MANAGER'">
          Manager
        </div>
      </div>

      <!-- Menu -->
      <ul class="nav flex-column px-3">
        <li class="nav-item">
          <a class="nav-link" routerLink="/dashboard" routerLinkActive="active-menu">
            <i class="me-2">📊</i> Dashboard
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" routerLink="/tasks" routerLinkActive="active-menu">
            <i class="me-2">📋</i> Tasks
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" routerLink="/projects" routerLinkActive="active-menu">
            <i class="me-2">📁</i> Projects
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" routerLink="/settings" routerLinkActive="active-menu">
            <i class="me-2">⚙️</i> Settings
          </a>
        </li>
      </ul>

      <!-- Logout -->
      <div class="mt-auto p-3">
        <button class="btn btn-outline-light w-100 rounded-pill shadow-sm" (click)="logout()">
          <i class="bi bi-box-arrow-right me-2"></i> Logout
        </button>
      </div>
    </nav>

    <!-- Topbar -->
    <main class="flex-fill bg-light">
      <div class="topbar d-flex justify-content-between align-items-center px-4 py-2">
        <div class="d-flex align-items-center">
          <button class="btn btn-light d-lg-none me-3" (click)="toggleSidebar()">
            <i class="bi bi-list"></i>
          </button>
          <span class="text-muted me-3">{{ currentDay }}</span>
          <span class="text-muted">{{ currentDate }}</span>
        </div>

        <!-- Dropdown Manager -->
        <div class="d-flex align-items-center">
          <div class="dropdown" *ngIf="currentUser">
            <button class="btn btn-light dropdown-toggle d-flex align-items-center gap-2" type="button" data-bs-toggle="dropdown">
              <div class="profile-circle small-profile">{{ currentUser?.fullName?.charAt(0) || 'M' }}</div>
              {{ currentUser?.fullName || 'Manager' }}
            </button>
            <ul class="dropdown-menu dropdown-menu-end">
              <li><a class="dropdown-item" routerLink="/dashboard">Dashboard</a></li>
              <li><a class="dropdown-item" routerLink="/tasks">Tasks</a></li>
              <li><a class="dropdown-item" routerLink="/projects">Projects</a></li>
              <li><a class="dropdown-item" routerLink="/settings">Settings</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item text-danger" (click)="logout()">Logout</a></li>
            </ul>
          </div>
        </div>
      </div>

      <div class="content-area p-4">
        <router-outlet></router-outlet>
      </div>
    </main>

    <div class="sidebar-backdrop" [class.show]="isMobileSidebarOpen" (click)="closeMobileSidebar()"></div>
  </div>
</ng-container>

<ng-template #authOnly>
  <router-outlet></router-outlet>
</ng-template>
